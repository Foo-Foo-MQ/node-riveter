(function(t,n){"object"==typeof module&&module.exports?module.exports=function(t){return t=t||require("underscore"),n(t)}:"function"==typeof define&&define.amd?define(["underscore"],function(e){return n(e,t)}):t.riveter=n(t._,t)})(this,function(t){if(!t.deepExtend){var n={"*":function(t,n,e){t[n]=e},object:function(t,n,e){t[n]=o(t[n]||{},e)},array:function(e,o,i){e[o]=[],t.each(i,function(t,i){n[r(t)](e[o],i,t)},this)}},e=function(n){return t.isArray(n)?"array":t.isDate(n)?"date":t.isRegExp(n)?"regex":typeof n},r=function(t){var r=e(t);return n[r]?r:"*"},o=function(e){return t.each(i.call(arguments,1),function(o){t.each(o,function(t,o){n[r(t)](e,o,t)})}),e};t.mixin({deepExtend:o})}var i=Array.prototype.slice,p=function(){for(var t=i.call(arguments,0);t.length;)p.rivet(t.shift())};return p.rivet=function(t){t.hasOwnProperty("extend")||(t.extend=function(n,e,r){return p.extend(t,n,e,r)}),t.hasOwnProperty("compose")||(t.compose=function(){return p.compose.apply(this,[t].concat(i.call(arguments,0)))}),t.hasOwnProperty("inherits")||(t.inherits=function(n,e,r){return p.inherits(t,n,e,r)}),t.hasOwnProperty("mixin")||(t.mixin=function(){return p.mixin.apply(this,[t].concat(i.call(arguments,0)))}),t.hasOwnProperty("punch")||(t.punch=function(){return p.punch.apply(this,[t].concat(i.call(arguments,0)))})},p.inherits=function(n,e,r,o){o=o||{};var i,u=function(){},c=function(){e.apply(this,arguments)};return"object"==typeof n?(n.hasOwnProperty("constructor")&&(c=n.constructor),i=n):(c=n,i=n.prototype),p.rivet(c),o.deep?t.deepExtend(c,e,r):t.defaults(c,e,r),u.prototype=e.prototype,c.prototype=new u,o.deep?t.deepExtend(c.prototype,i,{constructor:c}):t.extend(c.prototype,i,{constructor:c}),c.__super=e,c.__super__=e.prototype,c},p.extend=function(t,n,e,r){return p.inherits(n,t,e,r)},p.compose=function(){var n=i.call(arguments,0),e=n.shift();p.rivet(e);var r=t.reduce(n,function(t,n){return n.hasOwnProperty("_preInit")&&t.preInit.push(n._preInit),n.hasOwnProperty("_postInit")&&t.postInit.push(n._postInit),n=n.mixin||n,t.items.push(n),t},{items:[],preInit:[],postInit:[]}),o=e.extend({constructor:function(){var n=i.call(arguments,0);t.each(r.preInit,function(t){t.apply(this,n)},this),e.prototype.constructor.apply(this,n),t.each(r.postInit,function(t){t.apply(this,n)},this)}});return p.rivet(o),t.defaults(o.prototype,t.extend.apply(null,[{}].concat(r.items))),o},p.mixin=function(){var n=i.call(arguments,0),e=n.shift();return p.rivet(e),t.defaults(e.prototype,t.extend.apply(null,[{}].concat(n))),e},p.punch=function(){var n=i.call(arguments,0),e=n.shift();return p.rivet(e),t.extend(e.prototype,t.extend.apply(null,[{}].concat(n))),e},p});